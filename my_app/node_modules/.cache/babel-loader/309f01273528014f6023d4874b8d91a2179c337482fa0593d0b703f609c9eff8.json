{"ast":null,"code":"var _jsxFileName = \"D:\\\\Intern\\\\my_app\\\\src\\\\pages\\\\ManagePermissionsPage.jsx\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState, useContext } from 'react';\nimport { AuthContext } from '../AuthContext';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst ALL_PERMISSIONS = ['view_product', 'add_product', 'edit_product', 'delete_product', 'view_user', 'add_user_permission', 'remove_user_permission'];\nfunction ManagePermissionsPage() {\n  _s();\n  const {\n    token\n  } = useContext(AuthContext);\n  const [users, setUsers] = useState([]);\n  useEffect(() => {\n    fetch('/api/users', {\n      headers: {\n        Authorization: `Bearer ${token}`\n      }\n    }).then(res => res.json()).then(data => {\n      if (Array.isArray(data)) {\n        const filteredUsers = data.filter(u => !u.isAdmin);\n        setUsers(filteredUsers);\n      } else {\n        console.error('API trả về không phải mảng:', data);\n        setUsers([]);\n      }\n    }).catch(err => {\n      console.error('Lỗi khi fetch users:', err);\n      setUsers([]);\n    });\n  }, []);\n  const togglePermission = async (userId, permission, hasPermission) => {\n    const url = hasPermission ? '/api/users/remove-permission' : '/api/users/add-permission';\n    try {\n      const res = await fetch(url, {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n          Authorization: `Bearer ${token}`\n        },\n        body: JSON.stringify({\n          id: userId,\n          permissions: [permission]\n        })\n      });\n      if (!res.ok) throw new Error('Lỗi khi cập nhật quyền');\n\n      // Cập nhật giao diện\n      setUsers(prevUsers => prevUsers.map(u => u.id === userId ? {\n        ...u,\n        permissions: hasPermission ? u.permissions.filter(p => p !== permission) : [...u.permissions, permission]\n      } : u));\n    } catch (err) {\n      console.error('Cập nhật permission thất bại:', err);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      children: \"Qu\\u1EA3n l\\xFD quy\\u1EC1n ng\\u01B0\\u1EDDi d\\xF9ng\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 80,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"table\", {\n      border: \"1\",\n      cellPadding: \"8\",\n      children: [/*#__PURE__*/_jsxDEV(\"thead\", {\n        children: /*#__PURE__*/_jsxDEV(\"tr\", {\n          children: [/*#__PURE__*/_jsxDEV(\"th\", {\n            children: \"Email\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 84,\n            columnNumber: 13\n          }, this), ALL_PERMISSIONS.map(p => /*#__PURE__*/_jsxDEV(\"th\", {\n            children: p\n          }, p, false, {\n            fileName: _jsxFileName,\n            lineNumber: 86,\n            columnNumber: 15\n          }, this))]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 83,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 82,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"tbody\", {\n        children: users.map(user => /*#__PURE__*/_jsxDEV(\"tr\", {\n          children: [/*#__PURE__*/_jsxDEV(\"td\", {\n            children: user.email\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 93,\n            columnNumber: 15\n          }, this), ALL_PERMISSIONS.map(p => {\n            var _user$permissions;\n            return /*#__PURE__*/_jsxDEV(\"td\", {\n              children: /*#__PURE__*/_jsxDEV(\"input\", {\n                type: \"checkbox\",\n                checked: (_user$permissions = user.permissions) === null || _user$permissions === void 0 ? void 0 : _user$permissions.includes(p),\n                onChange: () => {\n                  var _user$permissions2;\n                  return togglePermission(user.id, p, (_user$permissions2 = user.permissions) === null || _user$permissions2 === void 0 ? void 0 : _user$permissions2.includes(p));\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 96,\n                columnNumber: 19\n              }, this)\n            }, p, false, {\n              fileName: _jsxFileName,\n              lineNumber: 95,\n              columnNumber: 17\n            }, this);\n          })]\n        }, user.id, true, {\n          fileName: _jsxFileName,\n          lineNumber: 92,\n          columnNumber: 13\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 90,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 81,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 79,\n    columnNumber: 5\n  }, this);\n}\n_s(ManagePermissionsPage, \"zIHF7bjJTXYFVIV4rc69CszNdvw=\");\n_c = ManagePermissionsPage;\nexport default ManagePermissionsPage;\nvar _c;\n$RefreshReg$(_c, \"ManagePermissionsPage\");","map":{"version":3,"names":["React","useEffect","useState","useContext","AuthContext","jsxDEV","_jsxDEV","ALL_PERMISSIONS","ManagePermissionsPage","_s","token","users","setUsers","fetch","headers","Authorization","then","res","json","data","Array","isArray","filteredUsers","filter","u","isAdmin","console","error","catch","err","togglePermission","userId","permission","hasPermission","url","method","body","JSON","stringify","id","permissions","ok","Error","prevUsers","map","p","children","fileName","_jsxFileName","lineNumber","columnNumber","border","cellPadding","user","email","_user$permissions","type","checked","includes","onChange","_user$permissions2","_c","$RefreshReg$"],"sources":["D:/Intern/my_app/src/pages/ManagePermissionsPage.jsx"],"sourcesContent":["import React, { useEffect, useState, useContext } from 'react';\nimport { AuthContext } from '../AuthContext';\n\nconst ALL_PERMISSIONS = [\n  'view_product',\n  'add_product',\n  'edit_product',\n  'delete_product',\n  'view_user',\n  'add_user_permission',\n  'remove_user_permission'\n];\n\nfunction ManagePermissionsPage() {\n  const { token } = useContext(AuthContext);\n  const [users, setUsers] = useState([]);\n\n  useEffect(() => {\n    fetch('/api/users', {\n      headers: {\n        Authorization: `Bearer ${token}`\n      }\n    })\n      .then(res => res.json())\n      .then(data => {\n        if (Array.isArray(data)) {\n          const filteredUsers = data.filter(u => !u.isAdmin);\n          setUsers(filteredUsers);\n        } else {\n          console.error('API trả về không phải mảng:', data);\n          setUsers([]);\n        }\n      })\n      .catch(err => {\n        console.error('Lỗi khi fetch users:', err);\n        setUsers([]);\n      });\n  }, []);\n\n  const togglePermission = async (userId, permission, hasPermission) => {\n    const url = hasPermission\n      ? '/api/users/remove-permission'\n      : '/api/users/add-permission';\n\n    try {\n      const res = await fetch(url, {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n          Authorization: `Bearer ${token}`\n        },\n        body: JSON.stringify({\n          id: userId,\n          permissions: [permission]\n        })\n      });\n\n      if (!res.ok) throw new Error('Lỗi khi cập nhật quyền');\n\n      // Cập nhật giao diện\n      setUsers(prevUsers =>\n        prevUsers.map(u =>\n          u.id === userId\n            ? {\n                ...u,\n                permissions: hasPermission\n                  ? u.permissions.filter(p => p !== permission)\n                  : [...u.permissions, permission]\n              }\n            : u\n        )\n      );\n    } catch (err) {\n      console.error('Cập nhật permission thất bại:', err);\n    }\n  };\n\n  return (\n    <div>\n      <h2>Quản lý quyền người dùng</h2>\n      <table border=\"1\" cellPadding=\"8\">\n        <thead>\n          <tr>\n            <th>Email</th>\n            {ALL_PERMISSIONS.map(p => (\n              <th key={p}>{p}</th>\n            ))}\n          </tr>\n        </thead>\n        <tbody>\n          {users.map(user => (\n            <tr key={user.id}>\n              <td>{user.email}</td>\n              {ALL_PERMISSIONS.map(p => (\n                <td key={p}>\n                  <input\n                    type=\"checkbox\"\n                    checked={user.permissions?.includes(p)}\n                    onChange={() =>\n                      togglePermission(user.id, p, user.permissions?.includes(p))\n                    }\n                  />\n                </td>\n              ))}\n            </tr>\n          ))}\n        </tbody>\n      </table>\n    </div>\n  );\n}\n\nexport default ManagePermissionsPage;\n"],"mappings":";;AAAA,OAAOA,KAAK,IAAIC,SAAS,EAAEC,QAAQ,EAAEC,UAAU,QAAQ,OAAO;AAC9D,SAASC,WAAW,QAAQ,gBAAgB;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAE7C,MAAMC,eAAe,GAAG,CACtB,cAAc,EACd,aAAa,EACb,cAAc,EACd,gBAAgB,EAChB,WAAW,EACX,qBAAqB,EACrB,wBAAwB,CACzB;AAED,SAASC,qBAAqBA,CAAA,EAAG;EAAAC,EAAA;EAC/B,MAAM;IAAEC;EAAM,CAAC,GAAGP,UAAU,CAACC,WAAW,CAAC;EACzC,MAAM,CAACO,KAAK,EAAEC,QAAQ,CAAC,GAAGV,QAAQ,CAAC,EAAE,CAAC;EAEtCD,SAAS,CAAC,MAAM;IACdY,KAAK,CAAC,YAAY,EAAE;MAClBC,OAAO,EAAE;QACPC,aAAa,EAAE,UAAUL,KAAK;MAChC;IACF,CAAC,CAAC,CACCM,IAAI,CAACC,GAAG,IAAIA,GAAG,CAACC,IAAI,CAAC,CAAC,CAAC,CACvBF,IAAI,CAACG,IAAI,IAAI;MACZ,IAAIC,KAAK,CAACC,OAAO,CAACF,IAAI,CAAC,EAAE;QACvB,MAAMG,aAAa,GAAGH,IAAI,CAACI,MAAM,CAACC,CAAC,IAAI,CAACA,CAAC,CAACC,OAAO,CAAC;QAClDb,QAAQ,CAACU,aAAa,CAAC;MACzB,CAAC,MAAM;QACLI,OAAO,CAACC,KAAK,CAAC,6BAA6B,EAAER,IAAI,CAAC;QAClDP,QAAQ,CAAC,EAAE,CAAC;MACd;IACF,CAAC,CAAC,CACDgB,KAAK,CAACC,GAAG,IAAI;MACZH,OAAO,CAACC,KAAK,CAAC,sBAAsB,EAAEE,GAAG,CAAC;MAC1CjB,QAAQ,CAAC,EAAE,CAAC;IACd,CAAC,CAAC;EACN,CAAC,EAAE,EAAE,CAAC;EAEN,MAAMkB,gBAAgB,GAAG,MAAAA,CAAOC,MAAM,EAAEC,UAAU,EAAEC,aAAa,KAAK;IACpE,MAAMC,GAAG,GAAGD,aAAa,GACrB,8BAA8B,GAC9B,2BAA2B;IAE/B,IAAI;MACF,MAAMhB,GAAG,GAAG,MAAMJ,KAAK,CAACqB,GAAG,EAAE;QAC3BC,MAAM,EAAE,KAAK;QACbrB,OAAO,EAAE;UACP,cAAc,EAAE,kBAAkB;UAClCC,aAAa,EAAE,UAAUL,KAAK;QAChC,CAAC;QACD0B,IAAI,EAAEC,IAAI,CAACC,SAAS,CAAC;UACnBC,EAAE,EAAER,MAAM;UACVS,WAAW,EAAE,CAACR,UAAU;QAC1B,CAAC;MACH,CAAC,CAAC;MAEF,IAAI,CAACf,GAAG,CAACwB,EAAE,EAAE,MAAM,IAAIC,KAAK,CAAC,wBAAwB,CAAC;;MAEtD;MACA9B,QAAQ,CAAC+B,SAAS,IAChBA,SAAS,CAACC,GAAG,CAACpB,CAAC,IACbA,CAAC,CAACe,EAAE,KAAKR,MAAM,GACX;QACE,GAAGP,CAAC;QACJgB,WAAW,EAAEP,aAAa,GACtBT,CAAC,CAACgB,WAAW,CAACjB,MAAM,CAACsB,CAAC,IAAIA,CAAC,KAAKb,UAAU,CAAC,GAC3C,CAAC,GAAGR,CAAC,CAACgB,WAAW,EAAER,UAAU;MACnC,CAAC,GACDR,CACN,CACF,CAAC;IACH,CAAC,CAAC,OAAOK,GAAG,EAAE;MACZH,OAAO,CAACC,KAAK,CAAC,+BAA+B,EAAEE,GAAG,CAAC;IACrD;EACF,CAAC;EAED,oBACEvB,OAAA;IAAAwC,QAAA,gBACExC,OAAA;MAAAwC,QAAA,EAAI;IAAwB;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAI,CAAC,eACjC5C,OAAA;MAAO6C,MAAM,EAAC,GAAG;MAACC,WAAW,EAAC,GAAG;MAAAN,QAAA,gBAC/BxC,OAAA;QAAAwC,QAAA,eACExC,OAAA;UAAAwC,QAAA,gBACExC,OAAA;YAAAwC,QAAA,EAAI;UAAK;YAAAC,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAI,CAAC,EACb3C,eAAe,CAACqC,GAAG,CAACC,CAAC,iBACpBvC,OAAA;YAAAwC,QAAA,EAAaD;UAAC,GAALA,CAAC;YAAAE,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAS,CACpB,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACA;MAAC;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACA,CAAC,eACR5C,OAAA;QAAAwC,QAAA,EACGnC,KAAK,CAACiC,GAAG,CAACS,IAAI,iBACb/C,OAAA;UAAAwC,QAAA,gBACExC,OAAA;YAAAwC,QAAA,EAAKO,IAAI,CAACC;UAAK;YAAAP,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAK,CAAC,EACpB3C,eAAe,CAACqC,GAAG,CAACC,CAAC;YAAA,IAAAU,iBAAA;YAAA,oBACpBjD,OAAA;cAAAwC,QAAA,eACExC,OAAA;gBACEkD,IAAI,EAAC,UAAU;gBACfC,OAAO,GAAAF,iBAAA,GAAEF,IAAI,CAACb,WAAW,cAAAe,iBAAA,uBAAhBA,iBAAA,CAAkBG,QAAQ,CAACb,CAAC,CAAE;gBACvCc,QAAQ,EAAEA,CAAA;kBAAA,IAAAC,kBAAA;kBAAA,OACR9B,gBAAgB,CAACuB,IAAI,CAACd,EAAE,EAAEM,CAAC,GAAAe,kBAAA,GAAEP,IAAI,CAACb,WAAW,cAAAoB,kBAAA,uBAAhBA,kBAAA,CAAkBF,QAAQ,CAACb,CAAC,CAAC,CAAC;gBAAA;cAC5D;gBAAAE,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OACF;YAAC,GAPKL,CAAC;cAAAE,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAQN,CAAC;UAAA,CACN,CAAC;QAAA,GAZKG,IAAI,CAACd,EAAE;UAAAQ,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAaZ,CACL;MAAC;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACG,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACH,CAAC;EAAA;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACL,CAAC;AAEV;AAACzC,EAAA,CAjGQD,qBAAqB;AAAAqD,EAAA,GAArBrD,qBAAqB;AAmG9B,eAAeA,qBAAqB;AAAC,IAAAqD,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}